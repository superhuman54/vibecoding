name: ðŸ·ï¸ ì´ìŠˆ ìžë™ ë¼ë²¨ë§

on:
  issues:
    types: [opened, reopened, edited]

jobs:
  auto-label-issues:
    name: ì´ìŠˆ ìžë™ ë¼ë²¨ë§
    runs-on: ubuntu-latest
    
    steps:
    - name: ì´ìŠˆ íƒ€ìž… ê¸°ë°˜ ë¼ë²¨ë§
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo } = context.repo;
          const issueNumber = context.payload.issue.number;
          const title = context.payload.issue.title.toLowerCase();
          const body = context.payload.issue.body || '';
          const content = (title + ' ' + body).toLowerCase();
          
          const labelsToAdd = [];
          
          // ì´ìŠˆ íƒ€ìž… ë¼ë²¨ë§
          if (title.includes('[bug]') || content.includes('bug') || content.includes('error') || 
              content.includes('crash') || content.includes('fail') || content.includes('broken')) {
            labelsToAdd.push('type/bug');
          } else if (title.includes('[feature]') || content.includes('feature') || 
                     content.includes('enhancement') || content.includes('improve')) {
            labelsToAdd.push('type/feature');
          } else if (title.includes('[question]') || content.includes('question') || 
                     content.includes('how to') || content.includes('help')) {
            labelsToAdd.push('type/question');
          } else if (title.includes('[docs]') || title.includes('[documentation]') || 
                     content.includes('documentation') || content.includes('readme')) {
            labelsToAdd.push('type/documentation');
          } else if (content.includes('enhance') || content.includes('improvement') || 
                     content.includes('optimize')) {
            labelsToAdd.push('type/enhancement');
          }
          
          // ìš°ì„ ìˆœìœ„ ë¼ë²¨ë§
          if (content.includes('critical') || content.includes('urgent') || 
              content.includes('crash') || content.includes('security') || 
              content.includes('data loss')) {
            labelsToAdd.push('priority/critical');
          } else if (content.includes('important') || content.includes('high') || 
                     content.includes('bug') || content.includes('error')) {
            labelsToAdd.push('priority/high');
          } else if (content.includes('feature') || content.includes('enhancement')) {
            labelsToAdd.push('priority/medium');
          } else {
            labelsToAdd.push('priority/low');
          }
          
          // ìƒíƒœ ë¼ë²¨ë§
          if (content.includes('wip') || content.includes('work in progress') || 
              content.includes('in progress')) {
            labelsToAdd.push('status/in-progress');
          } else if (content.includes('blocked') || content.includes('waiting') || 
                     content.includes('dependency')) {
            labelsToAdd.push('status/blocked');
          } else {
            labelsToAdd.push('status/triage');
          }
          
          // ë¼ë²¨ ì¶”ê°€
          if (labelsToAdd.length > 0) {
            await github.rest.issues.addLabels({
              owner,
              repo,
              issue_number: issueNumber,
              labels: labelsToAdd
            });
            
            console.log(`âœ… ì¶”ê°€ëœ ë¼ë²¨: ${labelsToAdd.join(', ')}`);
          }

  area-based-labeling:
    name: ì˜ì—­ ê¸°ë°˜ ë¼ë²¨ë§
    runs-on: ubuntu-latest
    
    steps:
    - name: ê¸°ìˆ  ì˜ì—­ë³„ ë¼ë²¨ë§
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo } = context.repo;
          const issueNumber = context.payload.issue.number;
          const title = context.payload.issue.title.toLowerCase();
          const body = context.payload.issue.body || '';
          const content = (title + ' ' + body).toLowerCase();
          
          const areaLabels = [];
          
          // ë°±ì—”ë“œ ê´€ë ¨
          if (content.includes('backend') || content.includes('api') || 
              content.includes('fastapi') || content.includes('server') || 
              content.includes('database') || content.includes('orm')) {
            areaLabels.push('area/backend');
          }
          
          // í”„ë¡ íŠ¸ì—”ë“œ ê´€ë ¨
          if (content.includes('frontend') || content.includes('ui') || 
              content.includes('streamlit') || content.includes('interface') || 
              content.includes('web') || content.includes('css')) {
            areaLabels.push('area/frontend');
          }
          
          // AI/Agent ê´€ë ¨
          if (content.includes('agent') || content.includes('ai') || 
              content.includes('llm') || content.includes('langgraph') || 
              content.includes('gemini') || content.includes('langsmith')) {
            areaLabels.push('area/agent');
          }
          
          // ë¬¸ì„œ ê´€ë ¨
          if (content.includes('docs') || content.includes('documentation') || 
              content.includes('readme') || content.includes('guide') || 
              content.includes('tutorial')) {
            areaLabels.push('area/documentation');
          }
          
          // í…ŒìŠ¤íŠ¸ ê´€ë ¨
          if (content.includes('test') || content.includes('testing') || 
              content.includes('pytest') || content.includes('unit test') || 
              content.includes('integration')) {
            areaLabels.push('area/testing');
          }
          
          // ì¸í”„ë¼/ë°°í¬ ê´€ë ¨
          if (content.includes('docker') || content.includes('deploy') || 
              content.includes('ci/cd') || content.includes('github actions') || 
              content.includes('devops')) {
            areaLabels.push('area/ci-cd');
          }
          
          // ë³´ì•ˆ ê´€ë ¨
          if (content.includes('security') || content.includes('auth') || 
              content.includes('authentication') || content.includes('vulnerability') || 
              content.includes('permission')) {
            areaLabels.push('area/security');
          }
          
          // ì„±ëŠ¥ ê´€ë ¨
          if (content.includes('performance') || content.includes('slow') || 
              content.includes('optimization') || content.includes('memory') || 
              content.includes('speed')) {
            areaLabels.push('area/performance');
          }
          
          // ì˜ì¡´ì„± ê´€ë ¨
          if (content.includes('dependency') || content.includes('package') || 
              content.includes('requirements') || content.includes('library') || 
              content.includes('version')) {
            areaLabels.push('dependencies');
          }
          
          // ì˜ì—­ ë¼ë²¨ ì¶”ê°€
          if (areaLabels.length > 0) {
            await github.rest.issues.addLabels({
              owner,
              repo,
              issue_number: issueNumber,
              labels: areaLabels
            });
            
            console.log(`âœ… ì˜ì—­ ë¼ë²¨ ì¶”ê°€: ${areaLabels.join(', ')}`);
          }

  special-labels:
    name: íŠ¹ìˆ˜ ìƒí™© ë¼ë²¨ë§
    runs-on: ubuntu-latest
    
    steps:
    - name: íŠ¹ìˆ˜ ìƒí™© ê°ì§€ ë° ë¼ë²¨ë§
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo } = context.repo;
          const issueNumber = context.payload.issue.number;
          const title = context.payload.issue.title.toLowerCase();
          const body = context.payload.issue.body || '';
          const content = (title + ' ' + body).toLowerCase();
          const author = context.payload.issue.user.login;
          
          const specialLabels = [];
          
          // ì²« ê¸°ì—¬ìž í™•ì¸
          const issues = await github.rest.issues.listForRepo({
            owner,
            repo,
            creator: author,
            state: 'all',
            per_page: 100
          });
          
          const userIssues = issues.data.filter(issue => 
            issue.user.login === author && issue.number !== issueNumber
          );
          
          if (userIssues.length === 0) {
            specialLabels.push('good first issue', 'first-time-contributor');
          }
          
          // ì¤‘ë³µ ì´ìŠˆ ê°€ëŠ¥ì„± ì²´í¬
          const allIssues = await github.rest.issues.listForRepo({
            owner,
            repo,
            state: 'open',
            per_page: 50
          });
          
          const similarIssues = allIssues.data.filter(issue => {
            if (issue.number === issueNumber) return false;
            const issueTitle = issue.title.toLowerCase();
            const titleWords = title.split(' ').filter(word => word.length > 3);
            return titleWords.some(word => issueTitle.includes(word));
          });
          
          if (similarIssues.length > 0) {
            specialLabels.push('possible-duplicate');
          }
          
          // ê¸´ê¸‰ ìƒí™© ê°ì§€
          if (content.includes('urgent') || content.includes('critical') || 
              content.includes('asap') || content.includes('immediately')) {
            specialLabels.push('urgent');
          }
          
          // ê¸°ëŠ¥ ìš”ì²­ í¬ê¸° ì¶”ì •
          if (content.includes('feature') || content.includes('enhancement')) {
            const featureSize = estimateFeatureSize(content);
            specialLabels.push(`size/${featureSize}`);
          }
          
          // Breaking Change ê°ì§€
          if (content.includes('breaking change') || content.includes('breaking') || 
              content.includes('backward compatibility')) {
            specialLabels.push('breaking-change');
          }
          
          // Help Wanted ë¼ë²¨
          if (content.includes('help wanted') || content.includes('help needed') || 
              content.includes('assistance') || userIssues.length === 0) {
            specialLabels.push('help wanted');
          }
          
          // íŠ¹ìˆ˜ ë¼ë²¨ ì¶”ê°€
          if (specialLabels.length > 0) {
            await github.rest.issues.addLabels({
              owner,
              repo,
              issue_number: issueNumber,
              labels: specialLabels
            });
            
            console.log(`âœ… íŠ¹ìˆ˜ ë¼ë²¨ ì¶”ê°€: ${specialLabels.join(', ')}`);
            
            // ì¤‘ë³µ ì´ìŠˆ ê°ì§€ ì‹œ ëŒ“ê¸€ ì¶”ê°€
            if (specialLabels.includes('possible-duplicate')) {
              const duplicateComment = `## ðŸ” ì¤‘ë³µ ì´ìŠˆ ê°€ëŠ¥ì„± ê°ì§€

              ìœ ì‚¬í•œ ì œëª©ì˜ ì´ìŠˆë“¤ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤:
              ${similarIssues.slice(0, 3).map(issue => 
                `- [#${issue.number}](${issue.html_url}) ${issue.title}`
              ).join('\n')}
              
              **í™•ì¸ ì‚¬í•­:**
              - ìœ„ ì´ìŠˆë“¤ê³¼ ë™ì¼í•œ ë¬¸ì œì¸ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”
              - ë‹¤ë¥¸ ë¬¸ì œë¼ë©´ ì°¨ì´ì ì„ ëª…í™•ížˆ ì„¤ëª…í•´ ì£¼ì„¸ìš”
              - ë™ì¼í•œ ë¬¸ì œë¼ë©´ ê¸°ì¡´ ì´ìŠˆì— ëŒ“ê¸€ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”
              
              ---
              _ìžë™ìœ¼ë¡œ ê°ì§€ëœ ì¤‘ë³µ ê°€ëŠ¥ì„±ìž…ë‹ˆë‹¤._`;
              
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: issueNumber,
                body: duplicateComment
              });
            }
            
            // ì²« ê¸°ì—¬ìž íŠ¹ë³„ ì•ˆë‚´
            if (specialLabels.includes('first-time-contributor')) {
              const firstContributorComment = `## ðŸŒŸ ì²« ê¸°ì—¬ìž í™˜ì˜ ê°€ì´ë“œ

              ì²« ë²ˆì§¸ ì´ìŠˆë¥¼ ì œì¶œí•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ë‹¤ìŒ ê°€ì´ë“œë¥¼ ì°¸ê³ í•´ ì£¼ì„¸ìš”:
              
              ### ðŸ“š ìœ ìš©í•œ ë¦¬ì†ŒìŠ¤
              - [ê¸°ì—¬ ê°€ì´ë“œ](./.cursor/rules/github-management.mdc)
              - [í”„ë¡œì íŠ¸ êµ¬ì¡°](./README.md)
              - [ê°œë°œ í™˜ê²½ ì„¤ì • ê°€ì´ë“œ](./backend/README.md)
              
              ### ðŸ¤ ë„ì›€ ë°›ê¸°
              - ì§ˆë¬¸ì´ ìžˆìœ¼ì‹œë©´ ì–¸ì œë“  ëŒ“ê¸€ë¡œ ë¬¸ì˜í•˜ì„¸ìš”
              - \`@${owner}\` ë©˜ì…˜ìœ¼ë¡œ ì§ì ‘ ë„ì›€ì„ ìš”ì²­í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤
              - ë‹¨ê³„ë³„ ê°€ì´ë“œê°€ í•„ìš”í•˜ì‹œë©´ ì•Œë ¤ì£¼ì„¸ìš”
              
              **í•¨ê»˜ ë©‹ì§„ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ê°€ìš”!** âœ¨
              
              ---
              _ì²« ê¸°ì—¬ìžë¥¼ ìœ„í•œ íŠ¹ë³„ ê°€ì´ë“œìž…ë‹ˆë‹¤._`;
              
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: issueNumber,
                body: firstContributorComment
              });
            }
          }
          
          // ê¸°ëŠ¥ í¬ê¸° ì¶”ì • í•¨ìˆ˜
          function estimateFeatureSize(content) {
            const keywords = {
              'XS': ['typo', 'text', 'color', 'style'],
              'S': ['button', 'link', 'simple', 'minor'],
              'M': ['form', 'page', 'component', 'feature'],
              'L': ['integration', 'complex', 'system', 'architecture'],
              'XL': ['redesign', 'migration', 'major', 'framework']
            };
            
            for (const [size, words] of Object.entries(keywords)) {
              if (words.some(word => content.includes(word))) {
                return size;
              }
            }
            return 'M'; // ê¸°ë³¸ê°’
          } 