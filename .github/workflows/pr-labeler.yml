name: ğŸ·ï¸ PR ìë™ ë¼ë²¨ë§

on:
  pull_request:
    types: [opened, reopened, edited, synchronize]

jobs:
  auto-label:
    name: ìë™ ë¼ë²¨ ì ìš©
    runs-on: ubuntu-latest
    
    steps:
    - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: PR ì œëª© ê¸°ë°˜ ë¼ë²¨ë§
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo } = context.repo;
          const prNumber = context.payload.pull_request.number;
          const title = context.payload.pull_request.title.toLowerCase();
          const body = context.payload.pull_request.body || '';
          
          const labelsToAdd = [];
          
          // ì œëª© ê¸°ë°˜ íƒ€ì… ë¼ë²¨ë§
          if (title.includes('[feat]') || title.includes('feature') || title.includes('add')) {
            labelsToAdd.push('type/feature');
          } else if (title.includes('[fix]') || title.includes('bug') || title.includes('hotfix')) {
            labelsToAdd.push('type/bugfix');
          } else if (title.includes('[docs]') || title.includes('documentation')) {
            labelsToAdd.push('type/documentation');
          } else if (title.includes('[style]') || title.includes('[refactor]') || title.includes('improve')) {
            labelsToAdd.push('type/enhancement');
          } else if (title.includes('[test]') || title.includes('testing')) {
            labelsToAdd.push('type/test');
          } else if (title.includes('[chore]') || title.includes('maintenance')) {
            labelsToAdd.push('type/chore');
          }
          
          // ìš°ì„ ìˆœìœ„ ë¼ë²¨ë§
          if (title.includes('urgent') || title.includes('critical') || title.includes('hotfix')) {
            labelsToAdd.push('priority/high');
          } else if (title.includes('important') || title.includes('[fix]')) {
            labelsToAdd.push('priority/medium');
          } else {
            labelsToAdd.push('priority/low');
          }
          
          // ë‚´ìš© ê¸°ë°˜ ë¼ë²¨ë§
          if (body.includes('breaking change') || body.includes('BREAKING CHANGE')) {
            labelsToAdd.push('breaking-change');
          }
          
          if (body.includes('wip') || body.includes('work in progress') || title.includes('wip')) {
            labelsToAdd.push('status/in-progress');
          } else {
            labelsToAdd.push('status/ready-for-review');
          }
          
          // ë¼ë²¨ ì¶”ê°€
          if (labelsToAdd.length > 0) {
            await github.rest.issues.addLabels({
              owner,
              repo,
              issue_number: prNumber,
              labels: labelsToAdd
            });
            
            console.log(`âœ… ì¶”ê°€ëœ ë¼ë²¨: ${labelsToAdd.join(', ')}`);
          }

  file-based-labeling:
    name: íŒŒì¼ ê¸°ë°˜ ë¼ë²¨ë§
    runs-on: ubuntu-latest
    
    steps:
    - name: ë³€ê²½ëœ íŒŒì¼ ê¸°ë°˜ ë¼ë²¨ë§
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo } = context.repo;
          const prNumber = context.payload.pull_request.number;
          
          // PRì˜ ë³€ê²½ëœ íŒŒì¼ë“¤ ê°€ì ¸ì˜¤ê¸°
          const files = await github.rest.pulls.listFiles({
            owner,
            repo,
            pull_number: prNumber
          });
          
          const areaLabels = [];
          
          // íŒŒì¼ ê²½ë¡œ ê¸°ë°˜ ì˜ì—­ ë¼ë²¨ë§
          files.data.forEach(file => {
            const filePath = file.filename;
            
            if (filePath.startsWith('backend/')) {
              if (!areaLabels.includes('area/backend')) {
                areaLabels.push('area/backend');
              }
            }
            
            if (filePath.startsWith('frontend/')) {
              if (!areaLabels.includes('area/frontend')) {
                areaLabels.push('area/frontend');
              }
            }
            
            if (filePath.startsWith('docs/') || filePath.endsWith('.md')) {
              if (!areaLabels.includes('area/documentation')) {
                areaLabels.push('area/documentation');
              }
            }
            
            if (filePath.startsWith('tests/') || filePath.includes('test')) {
              if (!areaLabels.includes('area/testing')) {
                areaLabels.push('area/testing');
              }
            }
            
            if (filePath.startsWith('.github/')) {
              if (!areaLabels.includes('area/ci-cd')) {
                areaLabels.push('area/ci-cd');
              }
            }
            
            if (filePath.includes('requirements.txt') || filePath.includes('package.json')) {
              if (!areaLabels.includes('dependencies')) {
                areaLabels.push('dependencies');
              }
            }
          });
          
          // ì˜ì—­ ë¼ë²¨ ì¶”ê°€
          if (areaLabels.length > 0) {
            await github.rest.issues.addLabels({
              owner,
              repo,
              issue_number: prNumber,
              labels: areaLabels
            });
            
            console.log(`âœ… ì˜ì—­ ë¼ë²¨ ì¶”ê°€: ${areaLabels.join(', ')}`);
          }

  security-labeling:
    name: ë³´ì•ˆ ê´€ë ¨ ë¼ë²¨ë§
    runs-on: ubuntu-latest
    
    steps:
    - name: ë³´ì•ˆ ê´€ë ¨ íŒŒì¼ í™•ì¸
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo } = context.repo;
          const prNumber = context.payload.pull_request.number;
          const title = context.payload.pull_request.title.toLowerCase();
          const body = context.payload.pull_request.body || '';
          
          const securityKeywords = [
            'security', 'vulnerability', 'auth', 'password', 'token', 'secret',
            'encryption', 'ssl', 'tls', 'cors', 'xss', 'sql injection', 'csrf'
          ];
          
          const hasSecurityContent = securityKeywords.some(keyword => 
            title.includes(keyword) || body.toLowerCase().includes(keyword)
          );
          
          // ë³€ê²½ëœ íŒŒì¼ì—ì„œ ë³´ì•ˆ ê´€ë ¨ íŒŒì¼ í™•ì¸
          const files = await github.rest.pulls.listFiles({
            owner,
            repo,
            pull_number: prNumber
          });
          
          const securityFiles = [
            'config.py', 'settings.py', '.env', 'requirements.txt',
            'auth', 'security', 'middleware'
          ];
          
          const hasSecurityFiles = files.data.some(file => 
            securityFiles.some(secFile => file.filename.includes(secFile))
          );
          
          if (hasSecurityContent || hasSecurityFiles) {
            await github.rest.issues.addLabels({
              owner,
              repo,
              issue_number: prNumber,
              labels: ['security']
            });
            
            console.log('âœ… ë³´ì•ˆ ë¼ë²¨ ì¶”ê°€ë¨');
            
            // ë³´ì•ˆ ê²€í†  ìš”ì²­ ëŒ“ê¸€
            const comment = `## ğŸ”’ ë³´ì•ˆ ê²€í†  í•„ìš”

            ì´ PRì€ ë³´ì•ˆê³¼ ê´€ë ¨ëœ ë³€ê²½ì‚¬í•­ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.
            
            **ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
            - [ ] ë¯¼ê°í•œ ì •ë³´ê°€ í•˜ë“œì½”ë”©ë˜ì§€ ì•Šì•˜ëŠ”ê°€?
            - [ ] ì¸ì¦/ì¸ê°€ ë¡œì§ì´ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì—ˆëŠ”ê°€?
            - [ ] ì…ë ¥ ê²€ì¦ì´ ì ì ˆíˆ ìˆ˜í–‰ë˜ëŠ”ê°€?
            - [ ] ë³´ì•ˆ í—¤ë”ê°€ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
            - [ ] ì˜ì¡´ì„± ë³´ì•ˆ ì·¨ì•½ì ì´ ì—†ëŠ”ê°€?
            
            **ì¶”ê°€ ê²€í† ê°€ í•„ìš”í•œ ê²½ìš° ë³´ì•ˆ ì „ë¬¸ê°€ì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.**
            
            ---
            _ìë™ìœ¼ë¡œ ê°ì§€ëœ ë³´ì•ˆ ê´€ë ¨ ë³€ê²½ì‚¬í•­ì…ë‹ˆë‹¤._`;
            
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: prNumber,
              body: comment
            });
          } 